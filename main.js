/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=r(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,i=function(){};return{s:i,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return c=t.done,t},e:function(t){s=!0,a=t},f:function(){try{c||null==n.return||n.return()}finally{if(s)throw a}}}}function r(t,e){if(t){if("string"==typeof t)return n(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,i(n.key),n)}}function i(e){var r=function(e){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(r)?r:r+""}var a=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[]},i=[{key:"bindToDOM",value:function(t){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=t}},{key:"drawUi",value:function(t){var e,r,n,o,i,a,c,s,l=this;this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",(function(t){return l.onNewGameClick(t)})),this.saveGameEl.addEventListener("click",(function(t){return l.onSaveGameClick(t)})),this.loadGameEl.addEventListener("click",(function(t){return l.onLoadGameClick(t)})),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(t);for(var u=0;u<Math.pow(this.boardSize,2);u+=1){var f=document.createElement("div");f.classList.add("cell","map-tile","map-tile-".concat((e=u,r=this.boardSize,void 0,void 0,void 0,void 0,void 0,void 0,a=(n=Math.floor(e/r))===r-1,c=0==(o=e%r),s=o===r-1,(i=0===n)&&c?"top-left":i&&s?"top-right":i?"top":a&&c?"bottom-left":a&&s?"bottom-right":a?"bottom":c?"left":s?"right":"center"))),f.addEventListener("mouseenter",(function(t){return l.onCellEnter(t)})),f.addEventListener("mouseleave",(function(t){return l.onCellLeave(t)})),f.addEventListener("click",(function(t){return l.onCellClick(t)})),this.boardEl.appendChild(f)}this.cells=Array.from(this.boardEl.children)}},{key:"redrawPositions",value:function(t){var r,n=e(this.cells);try{for(n.s();!(r=n.n()).done;)r.value.innerHTML=""}catch(t){n.e(t)}finally{n.f()}var o,i,a=e(t);try{for(a.s();!(o=a.n()).done;){var c=o.value,s=this.boardEl.children[c.position],l=document.createElement("div");l.classList.add("character",c.character.type);var u=document.createElement("div");u.classList.add("health-level");var f=document.createElement("div");f.classList.add("health-level-indicator","health-level-indicator-".concat((i=c.character.health)<15?"critical":i<50?"normal":"high")),f.style.width="".concat(c.character.health,"%"),u.appendChild(f),l.appendChild(u),s.appendChild(l)}}catch(t){a.e(t)}finally{a.f()}}},{key:"addCellEnterListener",value:function(t){this.cellEnterListeners.push(t)}},{key:"addCellLeaveListener",value:function(t){this.cellLeaveListeners.push(t)}},{key:"addCellClickListener",value:function(t){this.cellClickListeners.push(t)}},{key:"addNewGameListener",value:function(t){this.newGameListeners.push(t)}},{key:"addSaveGameListener",value:function(t){this.saveGameListeners.push(t)}},{key:"addLoadGameListener",value:function(t){this.loadGameListeners.push(t)}},{key:"onCellEnter",value:function(t){t.preventDefault();var e=this.cells.indexOf(t.currentTarget);this.cellEnterListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onCellLeave",value:function(t){t.preventDefault();var e=this.cells.indexOf(t.currentTarget);this.cellLeaveListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onCellClick",value:function(t){var e=this.cells.indexOf(t.currentTarget);this.cellClickListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onNewGameClick",value:function(t){t.preventDefault(),this.newGameListeners.forEach((function(t){return t.call(null)}))}},{key:"onSaveGameClick",value:function(t){t.preventDefault(),this.saveGameListeners.forEach((function(t){return t.call(null)}))}},{key:"onLoadGameClick",value:function(t){t.preventDefault(),this.loadGameListeners.forEach((function(t){return t.call(null)}))}},{key:"selectCell",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yellow";this.deselectCell(t),this.cells[t].classList.add("selected","selected-".concat(e))}},{key:"deselectCell",value:function(t){var e,o=this.cells[t];(e=o.classList).remove.apply(e,function(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||r(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(Array.from(o.classList).filter((function(t){return t.startsWith("selected")}))))}},{key:"showCellTooltip",value:function(t,e){this.cells[e].title=t}},{key:"hideCellTooltip",value:function(t){this.cells[t].title=""}},{key:"showDamage",value:function(t,e){var r=this;return new Promise((function(n){var o=r.cells[t],i=document.createElement("span");i.textContent=e,i.classList.add("damage"),o.appendChild(i),i.addEventListener("animationend",(function(){o.removeChild(i),n()}))}))}},{key:"setCursor",value:function(t){this.boardEl.style.cursor=t}},{key:"checkBinding",value:function(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}}],a=[{key:"showError",value:function(t){alert(t)}},{key:"showMessage",value:function(t){alert(t)}}],i&&o(t.prototype,i),a&&o(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,i,a}();const c="prairie",s="desert",l="arctic",u="mountain";function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function h(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,y(n.key),n)}}function y(t){var e=function(t){if("object"!=f(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=f(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==f(e)?e:e+""}var p=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.isPlayerTurn=!0,this.isGameOver=!1,this.level=1,this.selected=null,this.score=0,this.selectedCharacter=[],this.allPositions=[],this.statistics=[]},e=[{key:"from",value:function(t){return"object"===f(t)?t:null}}],null&&h(t.prototype,null),e&&h(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function m(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,d(n.key),n)}}function d(t){var e=function(t){if("object"!=v(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=v(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==v(e)?e:e+""}var b=function(){return t=function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"generic";if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.level=e,this.attack=0,this.defence=0,this.health=50,this.type=r,(this instanceof t?this.constructor:void 0)===t)throw new Error("Базовый класс не может быть использован для создания персонажа")},(e=[{key:"levelUp",value:function(){this.level+=1;var t=this.health/100*100;this.attack=Math.max(this.attack,this.attack*(80+t)/100),this.defence=Math.max(this.defence,this.defence*(80+t)/100),this.health+=Math.min(this.health+80,100)}}])&&m(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function w(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,P(n.key),n)}}function S(t,e,r){return e&&w(t.prototype,e),r&&w(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function P(t){var e=function(t){if("object"!=g(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=g(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==g(e)?e:e+""}var k=S((function t(e,r){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!(e instanceof b))throw new Error("character must be instance of Character or its children");if("number"!=typeof r)throw new Error("position must be a number");this.character=e,this.position=r}));function C(t){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function E(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(E=function(){return!!t})()}function O(t){return O=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},O(t)}function L(t,e){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},L(t,e)}var j=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=function(t,e,r){return e=O(e),function(t,e){if(e&&("object"==C(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,E()?Reflect.construct(e,r||[],O(t).constructor):e.apply(t,r))}(this,e,[t,"bowman"])).attack=25,r.defence=25,r.movement=2,r.attackRange=2,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&L(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(b);function T(t){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},T(t)}function x(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(x=function(){return!!t})()}function _(t){return _=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_(t)}function G(t,e){return G=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},G(t,e)}var M=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=function(t,e,r){return e=_(e),function(t,e){if(e&&("object"==T(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,x()?Reflect.construct(e,r||[],_(t).constructor):e.apply(t,r))}(this,e,[t,"daemon"])).attack=10,r.defence=10,r.movement=1,r.attackRange=4,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&G(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(b);function R(t){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R(t)}function A(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(A=function(){return!!t})()}function N(t){return N=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},N(t)}function B(t,e){return B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},B(t,e)}var D=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=function(t,e,r){return e=N(e),function(t,e){if(e&&("object"==R(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,A()?Reflect.construct(e,r||[],N(t).constructor):e.apply(t,r))}(this,e,[t,"magician"])).attack=10,r.defence=40,r.movement=1,r.attackRange=4,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&B(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(b);function I(t){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I(t)}function F(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(F=function(){return!!t})()}function z(t){return z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},z(t)}function U(t,e){return U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},U(t,e)}var q=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=function(t,e,r){return e=z(e),function(t,e){if(e&&("object"==I(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,F()?Reflect.construct(e,r||[],z(t).constructor):e.apply(t,r))}(this,e,[t,"swordsman"])).attack=40,r.defence=10,r.movement=4,r.attackRange=1,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&U(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(b);function H(t){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},H(t)}function Y(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Y=function(){return!!t})()}function J(t){return J=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},J(t)}function $(t,e){return $=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},$(t,e)}var W=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=function(t,e,r){return e=J(e),function(t,e){if(e&&("object"==H(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Y()?Reflect.construct(e,r||[],J(t).constructor):e.apply(t,r))}(this,e,[t,"undead"])).attack=40,r.defence=10,r.movement=4,r.attackRange=1,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&$(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(b);function K(t){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},K(t)}function Q(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Q=function(){return!!t})()}function V(t){return V=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},V(t)}function X(t,e){return X=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},X(t,e)}var Z=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=function(t,e,r){return e=V(e),function(t,e){if(e&&("object"==K(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Q()?Reflect.construct(e,r||[],V(t).constructor):e.apply(t,r))}(this,e,[t,"vampire"])).attack=25,r.defence=25,r.movement=2,r.attackRange=2,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&X(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(b);function tt(t){return tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tt(t)}function et(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,rt(n.key),n)}}function rt(t){var e=function(t){if("object"!=tt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=tt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==tt(e)?e:e+""}var nt=function(){return t=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.characters=e},e=[{key:"addCharacter",value:function(t){if(this.characters.includes(t))throw new Error("Такой персонаж уже есть в команде");this.characters.push(t)}},{key:"addAllCharacters",value:function(){for(var t=this,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];r.forEach((function(e){return t.addCharacter(e)}))}},{key:"removeCharacters",value:function(t){if(!this.characters.includes(t))throw new Error("Персонаж не найден в команде");this.characters=this.characters.filter((function(e){return e!==t}))}},{key:"getCharacters",value:function(){return this.characters}}],e&&et(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function ot(t){return ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ot(t)}function it(){it=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var i=e&&e.prototype instanceof d?e:d,a=Object.create(i.prototype),c=new x(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var h="suspendedStart",y="suspendedYield",p="executing",v="completed",m={};function d(){}function b(){}function g(){}var w={};l(w,a,(function(){return this}));var S=Object.getPrototypeOf,P=S&&S(S(_([])));P&&P!==r&&n.call(P,a)&&(w=P);var k=g.prototype=d.prototype=Object.create(w);function C(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var l=s.arg,u=l.value;return u&&"object"==ot(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(u).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=h;return function(i,a){if(o===p)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=L(c,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var l=f(e,r,n);if("normal"===l.type){if(o=n.done?v:y,l.arg===m)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=v,n.method="throw",n.arg=l.arg)}}}function L(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,L(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function _(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(ot(e)+" is not iterable")}return b.prototype=g,o(k,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:b,configurable:!0}),b.displayName=l(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,l(t,s,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},C(E.prototype),l(E.prototype,c,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new E(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},C(k),l(k,s,"Generator"),l(k,a,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=_,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),T(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:_(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}var at=it().mark(ct);function ct(t,e){var r,n;return it().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return r=t[Math.floor(Math.random()*t.length)],n=Math.floor(Math.random()*e)+1,o.next=5,new r(n);case 5:o.next=0;break;case 7:case"end":return o.stop()}}),at)}function st(t,e,r){for(var n=new nt,o=ct(t,e),i=0;i<r;i++){var a=o.next().value;a&&n.addCharacter(a)}return n}const lt="auto",ut="pointer",ft="crosshair",ht="not-allowed";function yt(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return pt(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?pt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function pt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function vt(){vt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var i=e&&e.prototype instanceof d?e:d,a=Object.create(i.prototype),c=new x(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var h="suspendedStart",y="suspendedYield",p="executing",v="completed",m={};function d(){}function b(){}function g(){}var w={};l(w,a,(function(){return this}));var S=Object.getPrototypeOf,P=S&&S(S(_([])));P&&P!==r&&n.call(P,a)&&(w=P);var k=g.prototype=d.prototype=Object.create(w);function C(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var l=s.arg,u=l.value;return u&&"object"==bt(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(u).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=h;return function(i,a){if(o===p)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=L(c,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var l=f(e,r,n);if("normal"===l.type){if(o=n.done?v:y,l.arg===m)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=v,n.method="throw",n.arg=l.arg)}}}function L(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,L(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function _(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(bt(e)+" is not iterable")}return b.prototype=g,o(k,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:b,configurable:!0}),b.displayName=l(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,l(t,s,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},C(E.prototype),l(E.prototype,c,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new E(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},C(k),l(k,s,"Generator"),l(k,a,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=_,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),T(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:_(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}function mt(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function dt(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){mt(i,n,o,a,c,"next",t)}function c(t){mt(i,n,o,a,c,"throw",t)}a(void 0)}))}}function bt(t){return bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bt(t)}function gt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,wt(n.key),n)}}function wt(t){var e=function(t){if("object"!=bt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=bt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==bt(e)?e:e+""}var St=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gamePlay=e,this.stateService=r,this.boardSize=this.gamePlay.boardSize,this.positionedCharacters=[],this.playerTypes=[j,q,D],this.enemyTypes=[Z,W,M],this.playerTeam=new nt,this.enemyTeam=new nt,this.gameState=new p,this.currentChar=null},e=[{key:"init",value:function(){this.gamePlay.drawUi(this.getThemeByLevel(this.gameState.level)),this.playerTeam=st(this.playerTypes,this.gameState.level,this.gameState.level+1),this.enemyTeam=st(this.enemyTypes,this.gameState.level,this.gameState.level+1);var t=this.getPositions(),e=t.playerPositions,r=t.enemyPositions;this.charactersPositions(e,this.playerTeam),this.charactersPositions(r,this.enemyTeam),this.gamePlay.redrawPositions(this.positionedCharacters),this.gamePlay.addCellEnterListener(this.onCellEnter.bind(this)),this.gamePlay.addCellLeaveListener(this.onCellLeave.bind(this)),this.gamePlay.addCellClickListener(this.onCellClick.bind(this)),this.gamePlay.addNewGameListener(this.onNewGameClick.bind(this)),this.gamePlay.addSaveGameListener(this.onSaveGameClick.bind(this)),this.gamePlay.addLoadGameListener(this.onLoadGameClick.bind(this))}},{key:"getThemeByLevel",value:function(t){switch(t){case 1:default:return c;case 2:return s;case 3:return l;case 4:return u}}},{key:"onCellClick",value:function(t){if(!this.gameState.isGameOver){var e=this.getCharacter(t);e?this.isPlayerCharacter(t)?(this.deselectAllCells(),this.gamePlay.selectCell(t),this.currentChar=e,this.gameState.selected=t):this.currentChar&&this.canAttack(t)?(this.deselectAllCells(),this.attack(t),this.currentChar=null,this.enemyTurn()):a.showError("Выберите своего персонажа"):this.currentChar&&this.canMove(t)&&(this.deselectAllCells(),this.currentChar.position=t,this.gamePlay.redrawPositions(this.positionedCharacters),this.currentChar=null,this.gameState.isPlayerTurn=!1,this.enemyTurn())}}},{key:"onCellEnter",value:function(t){if(!this.gameState.isGameOver){var e=this.getCharacter(t);if(e){this.gamePlay.setCursor(ut);var r=this.infoFormat(e.character);this.gamePlay.showCellTooltip(r,t)}this.currentChar&&(!e&&this.canMove(t)?(this.gamePlay.setCursor(ut),this.gamePlay.selectCell(t,"green")):e&&!this.isPlayerCharacter(t)?this.canAttack(t)?(this.gamePlay.setCursor(ft),this.gamePlay.selectCell(t,"red")):this.gamePlay.setCursor(ht):this.isPlayerCharacter(t)||this.gamePlay.setCursor(ht))}}},{key:"onCellLeave",value:function(t){this.gameState.isGameOver||(this.gamePlay.cells.forEach((function(t){t.classList.remove("selected-green")})),this.gamePlay.cells.forEach((function(t){t.classList.remove("selected-red")})),this.gamePlay.setCursor(lt),this.gamePlay.hideCellTooltip(t))}},{key:"getPositions",value:function(){for(var t=[],e=[],r=0;r<this.boardSize;r++)for(var n=0;n<this.boardSize;n++){var o=r*this.boardSize+n;0!==n&&1!==n||t.push(o),n!==this.boardSize-2&&n!==this.boardSize-1||e.push(o)}return{playerPositions:t,enemyPositions:e}}},{key:"charactersPositions",value:function(t,e){var r=this;e.characters.forEach((function(e){if(t.length>0){var n=Math.floor(Math.random()*t.length),o=t.splice(n,1)[0];r.positionedCharacters.push(new k(e,o))}}))}},{key:"infoFormat",value:function(t){return t&&"object"===bt(t)?"🎖 ".concat(t.level," ⚔ ").concat(t.attack," 🛡 ").concat(t.defence," ❤ ").concat(t.health):"Недопустимое значение"}},{key:"deselectAllCells",value:function(){var t=this;this.positionedCharacters.forEach((function(e){t.gamePlay.deselectCell(e.position)})),this.gamePlay.cells.forEach((function(t){t.classList.remove("selected-green","selected-red")}))}},{key:"calcRange",value:function(t,e){for(var r=[],n=this.boardSize,o=Math.floor(t/n),i=t%n,a=1;a<=e;a++)o+a<n&&r.push(t+n*a),o-a>=0&&r.push(t-n*a),i-a>=0&&r.push(t-a),i+a<n&&r.push(t+a),o+a<n&&i-a>=0&&r.push(t+(n*a-a)),o+a<n&&i+a<n&&r.push(t+(n*a+a)),o-a>=0&&i-a>=0&&r.push(t-(n*a+a)),o-a>=0&&i+a<n&&r.push(t-(n*a-a));return r}},{key:"canMove",value:function(t){if(this.currentChar){var e=this.currentChar.character.movement;return this.calcRange(this.currentChar.position,e).includes(t)}return!1}},{key:"canAttack",value:function(t){if(this.currentChar){var e=this.currentChar.character.attackRange;return this.calcRange(this.currentChar.position,e).includes(t)}return!1}},{key:"getCharacter",value:function(t){return this.positionedCharacters.find((function(e){return e.position===t}))}},{key:"isPlayerCharacter",value:function(t){if(this.getCharacter(t)){var e=this.getCharacter(t).character;return this.playerTypes.some((function(t){return e instanceof t}))}return!1}},{key:"attack",value:(n=dt(vt().mark((function t(e){var r,n,o;return vt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("Атака персонажа на ячейку:",e),!this.gameState.isPlayerTurn){t.next=18;break}if(r=this.currentChar.character,n=this.getCharacter(e).character,o=Math.max(r.attack-n.defence,.1*r.attack),n){t.next=8;break}return console.error("Целевой персонаж не найден"),t.abrupt("return");case 8:return console.log("Атакующий персонаж:",r),t.next=11,this.gamePlay.showDamage(e,o);case 11:return n.health-=o,n.health<=0&&(this.positionedCharacters.splice(this.positionedCharacters.indexOf(this.getCharacter(e)),1),this.enemyTeam.removeCharacters(n)),this.getResult(),this.gamePlay.redrawPositions(this.positionedCharacters),this.gameState.isPlayerTurn=!1,t.next=18,this.enemyTurn();case 18:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"enemyTurn",value:(r=dt(vt().mark((function t(){var e,r,n,o,i,a,c,s,l,u,f,h,y,p,v,m=this;return vt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.gameState.isPlayerTurn){t.next=2;break}return t.abrupt("return");case 2:if(e=this.positionedCharacters.filter((function(t){return m.playerTypes.some((function(e){return t.character instanceof e}))})),r=this.positionedCharacters.filter((function(t){return m.enemyTypes.some((function(e){return t.character instanceof e}))})),0!==e.length&&0!==r.length){t.next=6;break}return t.abrupt("return");case 6:n=null,o=null,i=yt(r),t.prev=9,i.s();case 11:if((a=i.n()).done){t.next=37;break}c=a.value,s=this.calcRange(c.position,c.character.attackRange),l=yt(e),t.prev=15,l.s();case 17:if((u=l.n()).done){t.next=25;break}if(f=u.value,!s.includes(f.position)){t.next=23;break}return n=c,o=f,t.abrupt("break",25);case 23:t.next=17;break;case 25:t.next=30;break;case 27:t.prev=27,t.t0=t.catch(15),l.e(t.t0);case 30:return t.prev=30,l.f(),t.finish(30);case 33:if(!o){t.next=35;break}return t.abrupt("break",37);case 35:t.next=11;break;case 37:t.next=42;break;case 39:t.prev=39,t.t1=t.catch(9),i.e(t.t1);case 42:return t.prev=42,i.f(),t.finish(42);case 45:if(!o){t.next=56;break}return h=Math.max(n.character.attack-o.character.defence,.1*n.character.attack),t.next=49,this.gamePlay.showDamage(o.position,h);case 49:o.character.health-=h,o.character.health<=0&&(this.positionedCharacters.splice(this.positionedCharacters.indexOf(o),1),this.playerTeam.removeCharacters(o.character)),this.gamePlay.redrawPositions(this.positionedCharacters),this.gameState.isPlayerTurn=!0,this.getResult(),t.next=62;break;case 56:n=r[Math.floor(Math.random()*r.length)],y=this.calcRange(n.position,n.character.movement),(p=y.filter((function(t){return!m.positionedCharacters.some((function(e){return e.position===t}))}))).length>0&&(v=p[Math.floor(Math.random()*p.length)],n.position=v),this.gamePlay.redrawPositions(this.positionedCharacters),this.gameState.isPlayerTurn=!0;case 62:case"end":return t.stop()}}),t,this,[[9,39,42,45],[15,27,30,33]])}))),function(){return r.apply(this,arguments)})},{key:"nextLevel",value:function(){var t,e=yt(this.playerTeam.characters);try{for(e.s();!(t=e.n()).done;)t.value.levelUp()}catch(t){e.e(t)}finally{e.f()}}},{key:"onNewGameClick",value:function(){this.gameState.isGameOver=!1,this.gameState.level=1,this.gameState.score=0,this.gamePlay.drawUi(this.getThemeByLevel(this.gameState.level));var t=this.getPositions(),e=t.playerPositions,r=t.enemyPositions;this.playerTeam=st(this.playerTypes,this.gameState.level,2),this.enemyTeam=st(this.enemyTypes,this.gameState.level,2),this.positionedCharacters=[],this.charactersPositions(e,this.playerTeam),this.charactersPositions(r,this.enemyTeam),this.gamePlay.redrawPositions(this.positionedCharacters)}},{key:"onSaveGameClick",value:function(){this.gameState.allPositions=this.positionedCharacters.map((function(t){return{character:{type:t.character.constructor.name.toLowerCase(),level:t.character.level,health:t.character.health},position:t.position}})),this.stateService.save(p.from(this.gameState)),a.showMessage("Игра сохранена")}},{key:"onLoadGameClick",value:function(){var t=this,e=this.stateService.load();e?(this.gameState.isPlayerTurn=e.isPlayerTurn,this.gameState.level=e.level,this.gameState.score=e.score,this.gameState.statistics=e.statistics,this.gameState.selected=e.selected,this.playerTeam=new nt,this.enemyTeam=new nt,this.positionedCharacters=[],e.allPositions.forEach((function(e){var r;switch(e.character.type){case"bowman":r=new j(e.character.level);break;case"daemon":r=new M(e.character.level);break;case"magician":r=new D(e.character.level);break;case"swordsman":r=new q(e.character.level);break;case"undead":r=new W(e.character.level);break;case"vampire":r=new Z(e.character.level);break;default:return void console.warn("Неизвестный тип персонажа")}r.health=e.character.health;var n=new k(r,e.position);t.positionedCharacters.push(n),t.playerTypes.some((function(t){return r instanceof t}))?t.playerTeam.addAllCharacters([r]):t.enemyTypes.some((function(t){return r instanceof t}))&&t.enemyTeam.addAllCharacters([r])})),a.showMessage("Игра загружена"),this.gamePlay.drawUi(this.getThemeByLevel(this.gameState.level)),this.gamePlay.redrawPositions(this.positionedCharacters)):a.showError("Ошибка загрузки")}},{key:"gameOver",value:function(){this.gameState.isGameOver=!0,this.gamePlay.setCursor(lt)}},{key:"getScore",value:function(){this.gameState.score+=this.playerTeam.getCharacters().reduce((function(t,e){return t+e.health}),0)}},{key:"getResult",value:function(){return 0===this.playerTeam.characters.length?(this.gameState.statistics.push(this.gameState.score),this.gameOver(),void a.showMessage("Вы проиграли! Количество очков: ".concat(this.gameState.score,"."))):0===this.enemyTeam.characters.length&&4===this.gameState.level?(this.getScore(),this.gameOver(),this.gameState.statistics.push(this.gameState.score),void a.showMessage("Вы победили! Количество очков: ".concat(this.gameState.score))):void(0===this.enemyTeam.characters.length&&this.gameState.level<=3&&(this.gameState.isPlayerTurn=!0,this.getScore(),a.showMessage("Переход на следующий уровень"),this.gameState.level+=1,console.log(this.gameState.level),this.nextLevel(),this.getLevelUp()))}},{key:"getLevelUp",value:function(){this.positionedCharacters=[],this.gamePlay.drawUi(this.getThemeByLevel(this.gameState.level)),this.enemyTeam=st(this.enemyTypes,this.gameState.level,this.gameState.level+1),this.playerTeam=st(this.playerTypes,this.gameState.level,this.gameState.level+1);var t=this.getPositions(),e=t.playerPositions,r=t.enemyPositions;this.charactersPositions(e,this.playerTeam),this.charactersPositions(r,this.enemyTeam),this.gamePlay.redrawPositions(this.positionedCharacters)}}],e&&gt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function Pt(t){return Pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pt(t)}function kt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ct(n.key),n)}}function Ct(t){var e=function(t){if("object"!=Pt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=Pt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Pt(e)?e:e+""}var Et=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.storage=e},(e=[{key:"save",value:function(t){this.storage.setItem("state",JSON.stringify(t))}},{key:"load",value:function(){try{return JSON.parse(this.storage.getItem("state"))}catch(t){throw new Error("Invalid state")}}}])&&kt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}(),Ot=new a;Ot.bindToDOM(document.querySelector("#game-container")),new St(Ot,new Et(localStorage)).init()})();